{"version":3,"sources":["frontend/core.cljs"],"mappings":";;;AAgBA,gCAAA,hCAAMA;AAAN,AAAA,0FAAA,mDAAA,2HAAA,2CAAA,qDAAA,YAAA,uDAAA,gBAAA,oDAAA,MAAA,qDAAA,MAAA,uDAAA,oBAAA,2HAAA,2CAAA,qDAAA,YAAA,uDAAA,iBAAA,oDAAA,MAAA,qDAAA,MAAA,uDAAA,oBAAA,2HAAA,2CAAA,qDAAA,YAAA,uDAAA,gBAAA,oDAAA,MAAA,qDAAA,OAAA,uDAAA,r2CAEIC,8eAMAA,+eAMAA;;AAOJ,8BAAA,9BAAMC;AAAN,OAEG,AAACC,PACD,2CACC,WAAKC;AAAL,AACE,mBAAA,ZAACC,oCAAuCD;;;AAE9C,4CAAA,5CAAME,gGACHC;AADH,AAEE,IAAAC,aAAA,AAAAC,gBAAqC,sDAAA,mFAAA,zIAACK;IAAtCN,iBAAA,AAAAE,4BAAAF;2BAAA,AAAAG,4CAAAH,eAAA,lFAAcI;WAAd,AAAAD,4CAAAH,eAAA,lEAA6BK;AAA7B,AACE,oBAAI,iBAAAE,oBAAKH;AAAL,AAAA,oBAAAG;AAAoB,OAAA,kGAAcF;;AAAlCE;;;AACF,6DAAA,mFAAA,uGAAA,2CAAA,gDAAA,IAAA,/UAACC,wLAAiBC,kNACmBC;;AACrCX;;;AAEN,iCAAA,jCAAMY,0EACHZ;AADH,AAEE,IAAAa,aAAA,AAAAX,gBAAqC,sDAAA,mFAAA,zIAACK;IAAtCM,iBAAA,AAAAV,4BAAAU;2BAAA,AAAAT,4CAAAS,eAAA,lFAAcR;WAAd,AAAAD,4CAAAS,eAAA,lEAA6BP;AAA7B,AACE,GACE,AAACQ,cAAIT;AACL,6DAAA,mFAAA,uGAAA,2CAAA,gDAAA,SAAA,pVAACI,wLAAiBC,uNACmBC;;AAHvC,GAIE,AAACG,cAAI,AAAA,kGAAcR;AACnB,6DAAA,mFAAA,uGAAA,2CAAA,gDAAA,gBAAA,3VAACG,wLAAiBC,8NACmBC;;AANvC,AAOQX;;;;;AAEZ,2BAAA,3BAAMe;AAAN,AAAA,0FAAA,qGAAA,mFAAA,oGAAA,2CAAA,qDAAA,IAAA,sRAAA,mFAAA,oGAAA,2CAAA,qDAAA,UAAA,oSAAA,mFAAA,oGAAA,2CAAA,qDAAA,gBAAA,oQAAA,mFAAA,oGAAA,2CAAA,qDAAA,SAAA,v/DACMC,wLACCC,oNAA0B,AAACL,+BACA,sDAAA,tDAACH,yIAAcS,qLAC1CD,0NAAgC,AAAClB,0CACA,sDAAA,tDAACU,yIAAcU,wLAChDF,gOAAsC,sDAAA,tDAACR,yIAAcW,kMACrDH,yNAA+B,AAAClB,0CACA,sDAAA,tDAACU,yIAAcY;;AAEtD,oBAAA,pBAAMC;AAAN,AAAA,0FAAA,4GAAA,mFAAA,mDAAA,2CAAA,gEAAA,uKAAA,yHAAA,9kBAaMC,wiBAGD9B,yHACAsB;;AAEL,qBAAA,rBAAeS;AAAf,AACE,uBAAA,mFAAA,1GAACC;;AACD,wDAAA,jDAACC,oIAAaJ,0BAAK,wBAAA,xBAAiBK","names":["frontend.core/floating-shapes","frontend.components.floating-shape/view","frontend.core/checking-auth","frontend.api.core/check-auth","auth-state","js/console.log","frontend.core/redirect-authenticated-user","children","map__15311","cljs.core/deref","cljs.core/--destructure-map","cljs.core.get","authenticated?","user","re_frame.core.subscribe","and__5000__auto__","reagent.core.as_element","js/module$node_modules$react_router_dom$dist$main.Navigate","cljs.core/replace","frontend.core/protected-routes","map__15312","cljs.core/not","frontend.core/app-routes","js/module$node_modules$react_router_dom$dist$main.Routes","js/module$node_modules$react_router_dom$dist$main.Route","frontend.pages.home/view","frontend.pages.sign-up/view","frontend.pages.email-verification/view","frontend.pages.login/view","frontend.core/app","js/module$node_modules$react_router_dom$dist$main.BrowserRouter","frontend.core/init","re-frame.core/dispatch","reagent.dom.render","js/document"],"sourcesContent":["(ns frontend.core\n  (:require\n   [\"react\" :as react]\n   [\"react-router-dom\" :refer [BrowserRouter Route Routes Navigate]]\n   [reagent.dom :as rdom]\n   [reagent.core :as r]\n   [re-frame.core :as rf]\n   [frontend.pages.login :as login]\n   [frontend.pages.sign-up :as signup]\n   [frontend.pages.home :as home]\n   [frontend.pages.email-verification :as email-verification]\n   [frontend.components.floating-shape :as floating-shape]\n   frontend.subs\n   frontend.events\n   [frontend.api.core :as api]))\n\n(defn floating-shapes []\n  [:div\n   [floating-shape/view\n    {:size  \"w-64 h-64\"\n     :color  \"bg-orange-500\"\n     :top    \"-5%\"\n     :left   \"10%\"\n     :delay   0}]\n   [floating-shape/view\n    {:size  \"w-48 h-48\"\n     :color  \"bg-emerald-500\"\n     :top    \"70%\"\n     :left   \"80%\"\n     :delay   0}]\n   [floating-shape/view\n    {:size  \"w-32 h-32\"\n     :color  \"bg-yellow-500\"\n     :top    \"40%\"\n     :left   \"-10%\"\n     :delay   0}]])\n\n(defn checking-auth []\n  (->\n   (api/check-auth)\n   (.then\n    (fn [auth-state]\n      (js/console.log \"is user authenticated\" auth-state)))))\n\n(defn redirect-authenticated-user\n  [children]\n  (let [{:keys [authenticated? user]} @(rf/subscribe [:get-auth-data])]\n    (if (and authenticated? (:is-verified user))\n      (r/as-element [:> Navigate {:to \"/\"\n                                  :replace replace}])\n      children)))\n\n(defn protected-routes\n  [children]\n  (let [{:keys [authenticated? user]} @(rf/subscribe [:get-auth-data])]\n    (cond\n      (not authenticated?) \n      (r/as-element [:> Navigate {:to \"/login\"\n                                  :replace replace}])\n      (not (:is-verified user))\n      (r/as-element [:> Navigate {:to \"/verify-email\"\n                                  :replace replace}])\n      :else children)))\n\n(defn app-routes []\n  [:> Routes\n   [:> Route {:path \"/\" :element (protected-routes\n                                  (r/as-element [home/view]))}]\n   [:> Route {:path \"/signup\" :element (redirect-authenticated-user\n                                        (r/as-element [signup/view]))}]\n   [:> Route {:path \"/verify-email\" :element (r/as-element [email-verification/view])}]\n   [:> Route {:path \"/login\" :element (redirect-authenticated-user\n                                       (r/as-element [login/view]))}]])\n\n(defn app []\n  \n  ;; TODO check auth status when the site is loaded\n  \n  ;; (react/useEffect\n  ;;  (fn []\n  ;;    (checking-auth))\n  ;;  [])\n  \n  ;; TODO add a loading spinner\n  ;; (when checking-auth\n  ;;   [loading-spinner])\n\n  [:> BrowserRouter\n   [:div {:className \"min-h-screen bg-gradient-to-br from-gray-900 via-yellow-900 to-emerald-900 \n                      flex items-center justify-center relative overflow-hidden\"}\n    [floating-shapes]\n    [app-routes]]])\n\n(defn ^:export init []\n  (rf/dispatch [:init-app-db])\n  (rdom/render [app] (.getElementById js/document \"root\")))\n"]}