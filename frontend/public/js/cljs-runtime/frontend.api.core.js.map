{"version":3,"sources":["frontend/api/core.cljs"],"mappings":"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","names":["frontend.api.core/url","frontend.api.core/sign-up","name","email","password","re-frame.core/dispatch","js/fetch","js/JSON.stringify","response","js/console.log","js/Error","data","auth","cljs.core.js__GT_clj","error","frontend.api.core/login","frontend.api.core/logout","frontend.api.core/forgot-password","frontend.api.core/reset-password","token","frontend.api.core/verify-email","verification-code","frontend.api.core/check-auth"],"sourcesContent":["(ns frontend.api.core\n  (:require [re-frame.core :as rf]))\n\n(def url \"http://localhost:3000/api/auth\")\n\n(defn sign-up [name email password]\n  (rf/dispatch [:update-loading-state true])\n  (-> (js/fetch (str url \"/signup\")\n                #js {:method  \"POST\"\n                     :headers #js {\"Content-Type\" \"application/json\"\n                                   \"Accept\"       \"application/json\"}\n                     :body    (js/JSON.stringify #js {:email    email\n                                                      :password password\n                                                      :name     name})})\n      (.then\n       (fn [response]\n         (js/console.log response)\n         (if (.-ok response)\n           (.json response)\n           (throw (js/Error \"Failed to fetch sign up data\")))))\n      (.then\n       (fn [data]\n         (js/console.log  \"sign up response data \" data)\n         (.-message data)\n         (let [auth  {:user           (js->clj (.-user ^js data) :keywordize-keys true)\n                      :authenticated? true\n                      :loading?       false}]\n           (rf/dispatch [:save-auth-response auth]))))\n      (.catch\n       (fn [error]\n         (rf/dispatch [:authentication-error error])\n         (throw (js/Error \"Failed to fetch data\"))))))\n\n(defn login [email password]\n  (rf/dispatch [:update-loading-state true])\n  (-> (js/fetch (str url \"/login\")\n                #js {:method  \"POST\"\n                     :headers #js {\"Content-Type\" \"application/json\"\n                                   \"Accept\"       \"application/json\"}\n                     :body    (js/JSON.stringify #js {:email    email\n                                                      :password password})})\n      (.then\n       (fn [response]\n         (js/console.log response)\n         (if (.-ok response)\n           (.json response)\n           (throw (js/Error \"Failed to fetch login data\")))))\n      (.then\n       (fn [data]\n         (.-message data)\n         (let [auth  {:user           (js->clj (.-user ^js data) :keywordize-keys true)\n                      :authenticated? true\n                      :loading?       false}]\n           (rf/dispatch [:save-auth-response auth]))))\n      (.catch\n       (fn [error]\n         (rf/dispatch [:authentication-error error])\n         (throw (js/Error \"Failed to fetch login data\"))))))\n\n\n(defn logout []\n  (rf/dispatch [:update-loading-state true])\n  (-> (js/fetch (str url \"/logout\"))\n      (.then\n       (fn [response]\n         (js/console.log response)\n         (if (.-ok response)\n           (.json response)\n           (throw (js/Error \"Failed to fetch logout data\")))))\n      (.then\n       (fn [data]\n         (.-message data)\n         (let [auth  {:user           nil\n                      :authenticated? false\n                      :loading?       false}]\n           (rf/dispatch [:save-auth-response auth]))))\n      (.catch\n       (fn [error]\n         (rf/dispatch [:authentication-error error])\n         (throw (js/Error \"Failed to fetch login data\"))))))\n\n\n\n(defn forgot-password [email]\n  (rf/dispatch [:save-auth-response {:loading? true :error nil}])\n  (-> (js/fetch (str url \"/forgot-password\")\n                #js {:method  \"POST\"\n                     :headers #js {\"Content-Type\" \"application/json\"\n                                   \"Accept\"       \"application/json\"}\n                     :body    (js/JSON.stringify #js {:email    email})})\n      (.then\n       (fn [response]\n         (js/console.log response)\n         (if (.-ok response)\n           (.json response)\n           (throw (js/Error \"Failed to fetch forgot password data\")))))\n      (.then\n       (fn [data]\n         (.-message data)\n         (let [auth  {:loading?         false\n                      :reset-link-sent? true}]\n           (rf/dispatch [:save-auth-response auth]))))\n      (.catch\n       (fn [error]\n         (rf/dispatch [:authentication-error error])\n         (throw (js/Error \"Failed to fetch forgot password data\"))))))\n\n(defn reset-password [token password]\n  (rf/dispatch [:save-auth-response {:loading? true :error nil :password-reset? false}])\n  (-> (js/fetch (str url \"/forgot-password\" token)\n                #js {:method  \"POST\"\n                     :headers #js {\"Content-Type\" \"application/json\"\n                                   \"Accept\"       \"application/json\"}\n                     :body    (js/JSON.stringify\n                               #js {:password  password})})\n      (.then\n       (fn [response]\n         (js/console.log response)\n         (if (.-ok response)\n           (.json response)\n           (throw (js/Error \"Failed to fetch forgot password data\")))))\n      (.then\n       (fn [data]\n         (.-message data)\n         (let [auth  {:loading?         false\n                      :password-reset?   true}]\n           (rf/dispatch [:save-auth-response auth]))))\n      (.catch\n       (fn [error]\n         (rf/dispatch [:authentication-error error])\n         (throw (js/Error \"Failed to fetch forgot password data\"))))))\n\n\n(defn verify-email [verification-code]\n  (rf/dispatch [:authentication-error])\n  (->\n   (js/fetch (str url \"/verify-email\")\n             #js {:method  \"POST\"\n                  :headers #js {\"Content-Type\" \"application/json\"\n                                \"Accept\"       \"application/json\"}\n                  :body    (js/JSON.stringify #js {:code    verification-code})})\n   (.then\n    (fn [response]\n      (if (.-ok response)\n        (.json response)\n        (throw (js/Error \"Failed to fetch verification data\")))))\n   (.then\n    (fn [data]\n      (.-message data)\n      (let [auth  {:user           (js->clj (.-user ^js data) :keywordize-keys true)\n                   :authenticated? true\n                   :loading?       false}]\n        (rf/dispatch [:save-auth-response auth]))))\n   (.catch\n    (fn [error]\n      (rf/dispatch [:authentication-error error])\n      (throw (js/Error \"Failed to fetch data\"))))))\n\n\n(defn check-auth []\n  (rf/dispatch [:checking-auth])\n  (->\n   (js/fetch (str url \"/check-auth\"))\n   (.then\n    (fn [response]\n      (if (.-ok response)\n        (.json response)\n        (throw (js/Error \"Failed to fetch auth status\")))))\n   (.then\n    (fn [data]\n      (.-message data)\n      (let [auth  {:user           (js->clj (.-user ^js data) :keywordize-keys true)\n                   :authenticated? true\n                   :checking-auth  false\n                   :loading?       false}]\n        (rf/dispatch [:save-auth-response auth]))))\n   (.catch\n    (fn [error]\n      (throw (js/Error \"Failed to fetch data\" error))))))"]}